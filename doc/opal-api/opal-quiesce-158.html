
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>OPAL_QUIESCE &#8212; skiboot v6.2-rc1
 documentation</title>
    <link rel="stylesheet" href="../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="OPAL_READ_TPO and OPAL_WRITE_TPO" href="opal-read-write-tpo-103-104.html" />
    <link rel="prev" title="OPAL_PRD_MSG" href="opal-prd-msg-113.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="opal-read-write-tpo-103-104.html" title="OPAL_READ_TPO and OPAL_WRITE_TPO"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="opal-prd-msg-113.html" title="OPAL_PRD_MSG"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">skiboot v6.2-rc1
 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">OPAL API Documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="opal-quiesce">
<span id="id1"></span><h1>OPAL_QUIESCE<a class="headerlink" href="#opal-quiesce" title="Permalink to this headline">¶</a></h1>
<p>The host OS can use OPAL_QUIESCE to ensure CPUs under host control are not
executing OPAL. This is useful in crash or shutdown scenarios to try to
ensure that CPUs are not holding locks, and is intended to be used with
OPAL_SIGNAL_SYSTEM_RESET, for example.</p>
<div class="section" id="arguments">
<h2>Arguments<a class="headerlink" href="#arguments" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">uint32_t</span> <span class="n">quiesce_type</span>
  <span class="n">QUIESCE_HOLD</span>        <span class="n">Wait</span> <span class="k">for</span> <span class="nb">all</span> <span class="n">target</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="n">currently</span> <span class="n">executing</span> <span class="n">OPAL</span> <span class="n">to</span>
                      <span class="k">return</span> <span class="n">to</span> <span class="n">the</span> <span class="n">host</span><span class="o">.</span> <span class="n">Any</span> <span class="n">new</span> <span class="n">OPAL</span> <span class="n">call</span> <span class="n">that</span> <span class="ow">is</span> <span class="n">made</span>
                      <span class="n">will</span> <span class="n">be</span> <span class="n">held</span> <span class="n">off</span> <span class="n">until</span> <span class="n">QUIESCE_RESUME</span><span class="o">.</span>
  <span class="n">QUIESCE_REJECT</span>      <span class="n">Wait</span> <span class="k">for</span> <span class="nb">all</span> <span class="n">target</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="n">currently</span> <span class="n">executing</span> <span class="n">OPAL</span> <span class="n">to</span>
                      <span class="k">return</span> <span class="n">to</span> <span class="n">the</span> <span class="n">host</span><span class="o">.</span> <span class="n">Any</span> <span class="n">new</span> <span class="n">OPAL</span> <span class="n">call</span> <span class="n">that</span> <span class="ow">is</span> <span class="n">made</span>
                      <span class="n">will</span> <span class="n">fail</span> <span class="k">with</span> <span class="n">OPAL_BUSY</span> <span class="n">until</span> <span class="n">QUIESCE_RESUME</span><span class="o">.</span>
  <span class="n">QUIESCE_LOCK_BREAK</span>  <span class="n">After</span> <span class="n">QUIESCE_HOLD</span> <span class="ow">or</span> <span class="n">QUIESCE_REJECT</span> <span class="ow">is</span> <span class="n">successful</span><span class="p">,</span>
                      <span class="n">the</span> <span class="n">CPU</span> <span class="n">can</span> <span class="n">call</span> <span class="n">QUIESCE_LOCK_BREAK</span> <span class="n">to</span> <span class="n">skip</span> <span class="nb">all</span>
                      <span class="n">locking</span> <span class="ow">in</span> <span class="n">OPAL</span> <span class="n">to</span> <span class="n">give</span> <span class="n">the</span> <span class="n">best</span> <span class="n">chance</span> <span class="n">of</span> <span class="n">making</span>
                      <span class="n">progress</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">crash</span><span class="o">/</span><span class="n">debug</span> <span class="n">paths</span><span class="o">.</span> <span class="n">The</span> <span class="n">host</span> <span class="n">should</span>
                      <span class="n">ensure</span> <span class="nb">all</span> <span class="n">other</span> <span class="n">CPUs</span> <span class="n">are</span> <span class="n">stopped</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">g</span><span class="o">.</span><span class="p">,</span> <span class="k">with</span>
                      <span class="n">OPAL_SIGNAL_SYSTEM_RESET</span><span class="p">)</span> <span class="n">before</span> <span class="n">this</span> <span class="n">call</span> <span class="ow">is</span> <span class="n">made</span><span class="p">,</span> <span class="n">to</span>
                      <span class="n">avoid</span> <span class="n">concurrency</span><span class="o">.</span>
  <span class="n">QUIESCE_RESUME</span>      <span class="n">Undo</span> <span class="n">the</span> <span class="n">effects</span> <span class="n">of</span> <span class="n">QUIESCE_HOLD</span><span class="o">/</span><span class="n">QUIESCE_REJECT</span> <span class="ow">and</span>
                      <span class="n">QUIESCE_LOCK_BREAK</span> <span class="n">calls</span><span class="o">.</span>
  <span class="n">QUIESCE_RESUME_FAST_REBOOT</span>
                      <span class="n">As</span> <span class="n">above</span><span class="p">,</span> <span class="n">but</span> <span class="n">also</span> <span class="n">reset</span> <span class="n">the</span> <span class="n">tracking</span> <span class="n">of</span> <span class="n">OS</span> <span class="n">calls</span>
                      <span class="n">into</span> <span class="n">firmware</span> <span class="k">as</span> <span class="n">part</span> <span class="n">of</span> <span class="n">fast</span> <span class="n">reboot</span> <span class="p">(</span><span class="n">secondaries</span>
                      <span class="n">will</span> <span class="n">never</span> <span class="k">return</span> <span class="n">to</span> <span class="n">OS</span><span class="p">,</span> <span class="n">but</span> <span class="n">instead</span> <span class="n">be</span> <span class="n">released</span>
                      <span class="n">into</span> <span class="n">a</span> <span class="n">new</span> <span class="n">OS</span> <span class="n">boot</span><span class="p">)</span><span class="o">.</span>

<span class="n">int32_t</span> <span class="n">target_cpu</span>
  <span class="n">cpu_nr</span> <span class="o">&gt;=</span> <span class="mi">0</span>        <span class="n">The</span> <span class="n">cpu</span> <span class="n">server</span> <span class="n">number</span> <span class="n">of</span> <span class="n">the</span> <span class="n">target</span> <span class="n">cpu</span> <span class="n">to</span> <span class="n">reset</span><span class="o">.</span>
  <span class="o">-</span><span class="mi">1</span>                 <span class="n">All</span> <span class="n">cpus</span> <span class="k">except</span> <span class="n">the</span> <span class="n">current</span> <span class="n">one</span> <span class="n">should</span> <span class="n">be</span> <span class="n">quiesced</span><span class="o">.</span>
</pre></div>
</div>
</div>
<div class="section" id="returns">
<h2>Returns<a class="headerlink" href="#returns" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt>OPAL_SUCCESS</dt>
<dd>The quiesce call was successful.</dd>
<dt>OPAL_PARTIAL</dt>
<dd>Some or all of the CPUs executing OPAL when the call was made did not
return to the host after a timeout of 1 second. This is a best effort
at quiescing OPAL, and QUIESCE_RESUME must be called to resume normal
firmware operation.</dd>
<dt>OPAL_PARAMETER</dt>
<dd>A parameter was incorrect.</dd>
<dt>OPAL_BUSY</dt>
<dd>This CPU was not able to complete the operation, either because another
has concurrently started quiescing the system, or because it has not
successfully called QUIESCE_HOLD or QUIESCE_REJECT before attempting
QUIESCE_LOCK_BREAK or QUIESCE_RESUME.</dd>
</dl>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">OPAL_QUIESCE</a><ul>
<li><a class="reference internal" href="#arguments">Arguments</a></li>
<li><a class="reference internal" href="#returns">Returns</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="opal-prd-msg-113.html"
                        title="previous chapter">OPAL_PRD_MSG</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="opal-read-write-tpo-103-104.html"
                        title="next chapter">OPAL_READ_TPO and OPAL_WRITE_TPO</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/opal-api/opal-quiesce-158.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="opal-read-write-tpo-103-104.html" title="OPAL_READ_TPO and OPAL_WRITE_TPO"
             >next</a> |</li>
        <li class="right" >
          <a href="opal-prd-msg-113.html" title="OPAL_PRD_MSG"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">skiboot v6.2-rc1
 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >OPAL API Documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2016-2017, IBM, others.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.6.
    </div>
  </body>
</html>